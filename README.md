# poster-map

選挙用のポスター掲示場所をまとめた地図です。
データーベース用のサーバーを用意するのがめんどくさい。
そもそも、レンタルサーバーがデーターベース用のサーバーを貸し出してない。
データーベースレス運用をしたい状況を想定して作ってます。
諸般の事情により埼玉県の奴だけテスト用に付属しています。

デモサイト
https://ss749137.stars.ne.jp/

## 使い方

青い丸がポスターの存在する場所です。
青い丸をタップするとポップアップが出て、ここで処理状況などがわかります。
ポップアップの「未処理」ボタンをクリックすると「処理済」に変わり、赤い丸に変わります。
このボタンを再度クリックすると、「未処理」に変わり、青い丸に変化します。
他の端末に処理状況を伝えたい場合は「コピーする」ボタンを押すとクリップボードに処理状況を含めた文字列がコピーされます。
（同じ端末であれば、別のアプリに切り替えた際に自動的に処理状況が保存されるので、別の地域のやつを表示しない限りは特に何かをする必要はありません）

まえの作業状態を復元したい場合は「復元する」ボタンを押して、文字列を貼り付け、「OK」を押すと、先ほどコピーした処理状況を取り込むことができます。
なお、作業状態は自動的に保存されるので、同じ端末であれば、「復元する」を押さなくても、トップページの「マップ」をクリックするだけで前の状態が復元されます。
もし、「マップ」以外のページに飛んでしまった場合は何も入力せずに「OK」を押すことで、前の状態を復元することができます。

### 処理状況の合成の仕方

「復元する」ボタンを押すと出てくる奴にコピーしたものを貼り付けることで作業状況を合成することができます。
例えば、一番目のテキストボックスにAさんが処理した奴を貼り付け、二番目のテキストボックスにBさんが作業した奴を貼り付け、改行します。
改行したところにCさんが作業した奴を貼り付け、「OK」ボタンを押すことで地図にはA・B・Cさんが作業した結果が表示されます。

## 選挙ポスター掲示場所の配置の仕方

public/data/〇〇/boardにkmlを配置してください。
〇〇はtype1などが入ります。
kmlファイルの文字コードはUTF-8でないとうまく処理ができません。
例えば、埼玉県さいたま市大宮区だとpublic/data/type1/board/japan/saitama/saitama_oomiya.kmlみたいな形で配置します。
配置後はMapList.vueに適宜追加してください。
先ほどのやつですと、

```
<RouterLink :to="{ path:'/map',query:{election:'type1',region:'japan',state:'saitama',city:'saitama_oomiya',type:'kml' }}">さいたま市大宮区</RouterLink>
```

みたいに書きます。

## 投票所の配置の仕方

public/data/〇〇/polling_placeにcsvを配置してください。
〇〇はtype1などが入ります。
csvは以下の形式で作り、文字コードはUTF-8、改行コードはLFで保存してください。

```
高齢者生きがい活動センター研修室・講座室,埼玉県さいたま市北区植竹町1-593-1
```

もし、経度と緯度がわかるなら以下のように描くこともできます。

```
市役所,川口市青木2−1−1,139.723344,35.806865
```


例えば、埼玉県さいたま市北区だとpublic/data/type1/polling_place/japan/saitama/saitama_kita.csvみたいな形で配置します。


みたいに書きます。

## 動作確認の仕方

「復元する」ボタンを押して、以下の文字列を貼り付けると動作確認ができます。

```
region=japan&state=saitama&city=test&type=json&election=type1
```

```
region=japan&state=saitama&city=test&type=kml&election=type1
```

```
region=japan&state=saitama&city=test_no_geo_cache&type=kml&election=type1
```

```
region=japan&state=saitama&city=test_geo_cache&type=kml&election=type1
```

## ビルドの仕方

```sh
npm run build-only
```

でビルドしてください。buildだとエラーを吐きます。

```sh
node GenerateLatLangCache.js
```

こちらはkmlを追加した場合だけ実行してください。
たまにkmlによっては経度と緯度がかけていることがあります。
実行しない場合、マップを表示するたびに経度と緯度を取得しようとするため、レスポンスが遅くなります。
また、これら情報の取得しているサーバーが特定のユーザーだけ二度と使えなくなるかもしれません。

## 開発環境

VisualStudio 2022
